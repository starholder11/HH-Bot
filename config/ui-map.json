{
  "version": "v1.4-defer-ui-generation-tools",
  "toolsToActions": {
    "searchunified": "searchUnified",
    "preparegenerate": "prepareGenerate",
    "generatecontent": "requestPinnedThenGenerate",
    "resolveassetrefs": "BACKEND_ONLY",
    "pintocanvas": "pinToCanvas",
    "pin": "pinToCanvas",
    "renameasset": "nameImage",
    "nameimage": "nameImage",
    "saveimage": "saveImage",
    "createcanvas": "canvasCreated",
    "createproject": "projectCreated",
    "chat": "chat"
  },
  "backendToolSynonyms": {
    "nameImage": {
      "backendTool": "renameAsset",
      "parameterTransforms": {
        "name": "newFilename"
      },
      "description": "Map nameImage to renameAsset with parameter transformation"
    }
  },
  "deferToFrontend": {
    "prepareGenerate": {
      "condition": "always",
      "description": "Always defer prepareGenerate to frontend for UI generation and canvas management",
      "payload": {
        "action": "prepareGenerate",
        "deferred": true
      }
    },
    "nameImage": {
      "condition": "always",
      "description": "Always defer nameImage to frontend for UI handling",
      "payload": {
        "action": "nameImage",
        "imageId": "current",
        "name": "{{params.name}}"
      }
    },
    "saveImage": {
      "condition": "always",
      "description": "Always defer saveImage to frontend for UI handling",
      "payload": {
        "action": "saveImage",
        "imageId": "current",
        "collection": "default"
      }
    },
    "pinToCanvas": {
      "condition": "always", 
      "description": "Always defer pinToCanvas to frontend for UI canvas management",
      "payload": {
        "action": "pinToCanvas",
        "deferred": true
      }
    }
  },
  "materializationRules": {
    "pinToCanvas": {
      "condition": "no_content_id",
      "description": "Auto-materialize content before pinning if no contentId",
      "prependSteps": [
        {
          "action": "nameImage",
          "payload": {
            "imageId": "current",
            "name": "{{params.name || extractName(userMessage) || 'Untitled'}}",
            "correlationId": "{{correlationId}}"
          }
        },
        {
          "action": "saveImage",
          "payload": {
            "imageId": "current",
            "collection": "default",
            "metadata": {},
            "correlationId": "{{correlationId}}"
          }
        }
      ]
    }
  }
}
